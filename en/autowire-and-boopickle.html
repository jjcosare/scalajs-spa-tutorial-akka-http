
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Autowire and BooPickle Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="server-side.html" />
    
    
    <link rel="prev" href="todo-module-and-data-flow.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getting-started.html">
            
                <a href="getting-started.html">
            
                    
                    Getting started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="application-structure.html">
            
                <a href="application-structure.html">
            
                    
                    Application structure
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="the-client.html">
            
                <a href="the-client.html">
            
                    
                    The Client
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="routing.html">
            
                <a href="routing.html">
            
                    
                    Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="main-menu.html">
            
                <a href="main-menu.html">
            
                    
                    Main menu
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="dashboard.html">
            
                <a href="dashboard.html">
            
                    
                    Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="css-in-scala.html">
            
                <a href="css-in-scala.html">
            
                    
                    CSS in Scala
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="integrating-javascript-components.html">
            
                <a href="integrating-javascript-components.html">
            
                    
                    Integrating JavaScript components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="todo-module-and-data-flow.html">
            
                <a href="todo-module-and-data-flow.html">
            
                    
                    Todo module and data flow
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.1.7" data-path="autowire-and-boopickle.html">
            
                <a href="autowire-and-boopickle.html">
            
                    
                    Autowire and BooPickle
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="server-side.html">
            
                <a href="server-side.html">
            
                    
                    Server side
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="testing.html">
            
                <a href="testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="debugging.html">
            
                <a href="debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="logging.html">
            
                <a href="logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="sbt-build-definition.html">
            
                <a href="sbt-build-definition.html">
            
                    
                    SBT build definition
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="using-resources-from-webjars.html">
            
                <a href="using-resources-from-webjars.html">
            
                    
                    Using resources from WebJars
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="production-build.html">
            
                <a href="production-build.html">
            
                    
                    Production build
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="faq.html">
            
                <a href="faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="what-next.html">
            
                <a href="what-next.html">
            
                    
                    What next?
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Autowire and BooPickle</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="autowire-and-boopickle">Autowire and BooPickle</h1>
<p>Web clients communicate with the server most commonly with <em>Ajax</em> which is a quite loosely defined collection of techniques. Most notable
JavaScript libraries like JQuery provide higher level access to the low level protocols exposed by the browser. Scala.js provides a nice
Ajax wrapper in <code>dom.extensions.Ajax</code> (or <code>dom.ext.Ajax</code> in scalajs-dom 0.8+) but it&apos;s still quite tedious to serialize/deserialize objects
and take care of all the dirty little details.</p>
<p>But fear not, there is no need to do all that yourself since our friend <a href="https://github.com/lihaoyi" target="_blank">Li Haoyi (lihaoyi)</a> has created and
published a great library called <a href="https://github.com/lihaoyi/autowire" target="_blank">Autowire</a>. Combined with my very own 
<a href="https://github.com/ochrons/boopickle" target="_blank">BooPickle</a> library you can easily handle client-server communication. Note that BooPickle uses
binary serialization format, so if you&apos;d prefer a JSON format, consider using <a href="https://github.com/lihaoyi/upickle" target="_blank">uPickle</a>. As the SPA tutorial
used to use uPickle for serialization, you can browse the repository history to see the relevant code 
<a href="https://github.com/ochrons/scalajs-spa-tutorial/blob/628bf9308aaebe7f3d0527007ef604801988ef42/js/src/main/scala/spatutorial/client/services/AjaxClient.scala" target="_blank">here</a>
and <a href="https://github.com/ochrons/scalajs-spa-tutorial/blob/628bf9308aaebe7f3d0527007ef604801988ef42/jvm/src/main/scala/spatutorial/server/MainApp.scala" target="_blank">here</a>.</p>
<p>To build your own client-server communication pathway all you need to do is to define a single object on the client side and another on the
server side.</p>
<pre><code class="lang-scala"><span class="hljs-keyword">import</span> boopickle.<span class="hljs-type">Default</span>._

<span class="hljs-comment">// client side</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">AjaxClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">autowire</span>.<span class="hljs-title">Client</span>[<span class="hljs-type">ByteBuffer</span>, <span class="hljs-type">Pickler</span>, <span class="hljs-type">Pickler</span>] </span>{
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">doCall</span></span>(req: <span class="hljs-type">Request</span>): <span class="hljs-type">Future</span>[<span class="hljs-type">ByteBuffer</span>] = {
    dom.ext.<span class="hljs-type">Ajax</span>.post(
      url = <span class="hljs-string">&quot;/api/&quot;</span> + req.path.mkString(<span class="hljs-string">&quot;/&quot;</span>),
      data = <span class="hljs-type">Pickle</span>.intoBytes(req.args),
      responseType = <span class="hljs-string">&quot;arraybuffer&quot;</span>,
      headers = <span class="hljs-type">Map</span>(<span class="hljs-string">&quot;Content-Type&quot;</span> -&gt; <span class="hljs-string">&quot;application/octet-stream&quot;</span>)
    ).map(r =&gt; <span class="hljs-type">TypedArrayBuffer</span>.wrap(r.response.asInstanceOf[<span class="hljs-type">ArrayBuffer</span>]))
  }

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span></span>[<span class="hljs-type">Result</span>: <span class="hljs-type">Pickler</span>](p: <span class="hljs-type">ByteBuffer</span>) = <span class="hljs-type">Unpickle</span>[<span class="hljs-type">Result</span>].fromBytes(p)
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span></span>[<span class="hljs-type">Result</span>: <span class="hljs-type">Pickler</span>](r: <span class="hljs-type">Result</span>) = <span class="hljs-type">Pickle</span>.intoBytes(r)
}
</code></pre>
<p>The only variable specific to your application is the URL you want to use to call the server. Otherwise everything else it automatically
generated for you through the magic of macros. The server side is even simpler, just letting Autowire know that you want to use BooPickle
for serialization.</p>
<pre><code class="lang-scala"><span class="hljs-keyword">import</span> boopickle.<span class="hljs-type">Default</span>._

<span class="hljs-comment">// server side</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Router</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">autowire</span>.<span class="hljs-title">Server</span>[<span class="hljs-type">ByteBuffer</span>, <span class="hljs-type">Pickler</span>, <span class="hljs-type">Pickler</span>] </span>{
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span></span>[<span class="hljs-type">R</span>: <span class="hljs-type">Pickler</span>](p: <span class="hljs-type">ByteBuffer</span>) = <span class="hljs-type">Unpickle</span>[<span class="hljs-type">R</span>].fromBytes(p)
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span></span>[<span class="hljs-type">R</span>: <span class="hljs-type">Pickler</span>](r: <span class="hljs-type">R</span>) = <span class="hljs-type">Pickle</span>.intoBytes(r)
}
</code></pre>
<p>Now that you have the <code>AjaxClient</code> set up, calling the server is as simple as</p>
<pre><code class="lang-scala"><span class="hljs-keyword">import</span> scala.concurrent.<span class="hljs-type">ExecutionContext</span>.<span class="hljs-type">Implicits</span>.global
<span class="hljs-keyword">import</span> boopickle.<span class="hljs-type">Default</span>._
<span class="hljs-keyword">import</span> autowire._

<span class="hljs-type">AjaxClient</span>[<span class="hljs-type">Api</span>].getTodos().call().foreach { todos =&gt;
  println(<span class="hljs-string">s&quot;Got some things to do <span class="hljs-subst">$todos</span>&quot;</span>)
}
</code></pre>
<p>Note that you need those three imports to access the Autowire/BooPickle magic and to provide an execution context for the futures.</p>
<p>The <code>Api</code> is just a simple trait shared between the client and server.</p>
<pre><code class="lang-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Api</span> </span>{
  <span class="hljs-comment">// message of the day</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">motd</span></span>(name:<span class="hljs-type">String</span>) : <span class="hljs-type">String</span>

  <span class="hljs-comment">// get Todo items</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getTodos</span></span>() : <span class="hljs-type">Seq</span>[<span class="hljs-type">TodoItem</span>]

  <span class="hljs-comment">// update a Todo</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">updateTodo</span></span>(item: <span class="hljs-type">TodoItem</span>): <span class="hljs-type">Seq</span>[<span class="hljs-type">TodoItem</span>]

  <span class="hljs-comment">// delete a Todo</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deleteTodo</span></span>(itemId: <span class="hljs-type">String</span>): <span class="hljs-type">Seq</span>[<span class="hljs-type">TodoItem</span>]
}
</code></pre>
<p>Please check out <a href="https://github.com/ochrons/boopickle" target="_blank">BooPickle documentation</a> on what it can and cannot serialize. You might need to use 
something else if your data is complicated. Case classes, base collections and basic data types are a safe bet.</p>
<p>So how does this work on the server side?</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="todo-module-and-data-flow.html" class="navigation navigation-prev " aria-label="Previous page: Todo module and data flow">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="server-side.html" class="navigation navigation-next " aria-label="Next page: Server side">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Autowire and BooPickle","level":"1.3.1.7","depth":3,"next":{"title":"Server side","level":"1.3.2","depth":2,"path":"server-side.md","ref":"server-side.md","articles":[]},"previous":{"title":"Todo module and data flow","level":"1.3.1.6","depth":3,"path":"todo-module-and-data-flow.md","ref":"todo-module-and-data-flow.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"en","gitbook":"*"},"file":{"path":"autowire-and-boopickle.md","mtime":"2019-06-20T06:02:32.059Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-04-13T22:41:05.515Z"},"basePath":".","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

